{"time":"0007","tplId":"QUICKPAY@cashier-new-wk-card-flex","publishVersion":"150924","tag":"QUICKPAY","name":"cashier-new-wk-card-flex","data":{"tag":"html","children":[{"tag":"head","children":[{"tag":"script","src":"cashier-new-wk-card-flex.js"},{"tag":"meta","src":"AlipaySDK.bundle/amc.i18n","type":"i18n"},{"tag":"link","rel":"stylesheet","href":"AlipaySDK.bundle/amc.css"},{"tag":"script","src":"AlipaySDK.bundle/amc.js"},{"tag":"script","children":[{"text":"var rpc=amc.rpcData;var getTag=amc.fn.getById;var hide=amc.fn.hide;var show=amc.fn.show;var path=amc.path+\"alipay_msp_\";var infoPng=path+\"info\";var needInput=rpc.needinput;var inputsMap={cardname:\"cardName\",fullname:\"fullName\",validate:\"validate\",cvv2:\"cvv2\",email:\"email\",receiveaddress:\"receiveAddress\"};var inputsReverseMap={};var showing={};var onInputVerify={validate:{regex:\"^(0[1-9]|1[012])/?\\\\d{2}$\",lastValue:\"\"},cvv2:{regex:\"^\\\\d{0,3}$\",lastValue:\"\"}};var onSubmitVerify={fullName:{regex:\"^\\\\S+\\\\s+\\\\S+.*$\",text:\"{{full_name_format_error}}\"},cvv2:{regex:\"^\\\\d{3}$\",text:\"{{cvv2_format_error}}\"},email:{regex:\"^([a-zA-Z0-9_.-])+@(([a-zA-Z0-9-])+.)+([a-zA-Z0-9]{2,4})+$\",text:\"{{email_format_error}}\"}};function updateInputState(a,b){a=amc.fn.isString(a)?getTag(a):a;if(a.value.length){amc.fn.hide(b)}else{amc.fn.show(b)}}function checkInput(a,b){updateInputState(a,b);updateSubmitState()}function updateSubmitState(){var a=document.getElementsByTagName(\"input\");var c=false;for(var b=0;b<a.length;b++){if(a[b].id&&!showing[a[b].id]){continue}if(a[b].value===\"\"){c=true;break}}if(showing.receiveAddress&&getTag(\"receiveAddress\").innerText==\"\"){c=true}getTag(\"submit\").disabled=c}function onInput(c,a){var b=getTag(c).value;if(onInputVerify[c]){if(b.match(onInputVerify[c][\"regex\"])){onInputVerify[c][\"lastValue\"]=b}else{getTag(c).value=onInputVerify[c][\"lastValue\"]}}if(a){updateInputState(c,a)}updateSubmitState()}function onclickCvv(){getTag(\"dlg_img\").src=path+\"cvv\";getTag(\"dlg_text\").innerText=\"{{cvv_info}}\";getTag(\"dlg_title\").innerText=\"{{cvv}}\";getTag(\"dlg\").showModal()}function onClickValidate(){getTag(\"dlg_img\").src=path+\"validate\";getTag(\"dlg_text\").innerText=\"{{validity_info}}\";getTag(\"dlg_title\").innerText=\"{{validity}}\";getTag(\"dlg\").showModal()}function onClickBill(){var f={action:{name:\"/card/wkSetBillAddress\"}};f.action[\"params\"]={};f.action[\"params\"][\"call_init\"]=true;var d={};var b=document.querySelectorAll(\"input\");for(var c=0;c<b.length;c++){var e=b[c].value?b[c].value.trim():\"\";var g=b[c].id;var a=inputsReverseMap[g];if(showing[g]){if(g===\"fullName\"){d[a]=unformatFullName(e)}else{if(g===\"validate\"){d[a]=unformatExpireDate(e)}else{d[a]=e}}}}f.param=d;document.submit(f)}function onSubmit(){for(var h in onSubmitVerify){if(!showing[h]){continue}var a=getTag(h);var f=a.value?a.value.trim():\"\";if(!f.match(onSubmitVerify[h].regex)){document.toast({text:onSubmitVerify[h].text,type:\"fail\"},function(){a.focus()});return}}var g={action:{name:\"/card/sign\",loadtxt:\"\"}};g.action[\"neec\"]=\"6004\";g.action[\"host\"]=rpc.pci_url;g.action[\"https\"]=true;g.action[\"enctype\"]=\"application/x-www-form-urlencoded\";g.action[\"request_param\"]=\"requestData\";g.action[\"params\"]={};g.action[\"params\"][\"cardtype\"]=\"WAI_KA\";g.action[\"params\"][\"ccdctoken\"]=rpc.ccdctoken;var e={};var c=document.querySelectorAll(\"input\");for(var d=0;d<c.length;d++){var f=c[d].value?c[d].value.trim():\"\";var h=c[d].id;var b=inputsReverseMap[h];if(showing[h]){if(h===\"fullName\"){e[b]=unformatFullName(f)}else{if(h===\"validate\"){e[b]=unformatExpireDate(f)}else{e[b]=f}}}}g.param=e;document.asyncSubmit(g,function(i){amc.fn.shouldShowBtnIndicator(i,\"submit\",\"loading\")});amc.fn.shouldShowBtnIndicator({pageloading:\"1\"},\"submit\",\"loading\")}function onBack(){amc.fn.exitConfirm(\"{{confirm_cancel_pay}}\")}function init(){try{initUI();if(amc.fn.logPageInit){amc.fn.logPageInit(true)}}catch(a){if(amc.fn.logPageInit){amc.fn.logPageInit()}}}function initUI(){var e=amc.fn.getNav(amc.res.navBack,\"{{return}}\",\"{{write_card_info}}\",null,null,onBack,null);getTag(\"body\").insertBefore(e,getTag(\"mainBody\"));if(amc.isAndroid){getTag(\"loading\").src=amc.path+\"alipay_msp_indicator_white_loading\"}var a=getTag(\"cvv2InfoImg\");var c=getTag(\"validateInfoPng\");var g=getTag(\"cvv2\");var d=getTag(\"validate\");a.src=infoPng;c.src=infoPng;getTag(\"billAddrRightArrow\").src=amc.res.arrowRight;if(needInput){for(var b in inputsMap){var f=inputsMap[b];if(needInput[b]&&needInput[b].display){if(b===\"cardname\"||b===\"receiveaddress\"){getTag(f).innerText=needInput[b].value||\"\"}else{if(b===\"validate\"){getTag(f).value=formatExpireDate(needInput[b].value)||\"\"}else{getTag(f).value=needInput[b].value||\"\"}}if(needInput[b].disable){if(!needInput[b].value){continue}getTag(f).disabled=true;getTag(f).style.color=\"#a5a5a5\"}show(f+\"Area\");showing[f]=true}inputsReverseMap[f]=b}}if(!(showing.fullName||showing.cvv2||showing.validate)){hide(\"nameCvv2ValidateSpace\")}checkInput(g,a);checkInput(d,c)}function onKeyDown(){if(event.which==4){onBack()}}function unformatFullName(a){if(a){return a.replace(/\\s\\s+/g,\" \").trim()}else{return a||\"\"}}function unformatExpireDate(a){if(a){return a.replace(\"/\",\"\")}else{return a||\"\"}}function formatExpireDate(a){if(a&&a.length===4&&(a.indexOf(\"/\")<0)){return a.substr(0,2)+\"/\"+a.substr(2)}else{return a||\"\"}};","tag":"text"}]},{"tag":"style","children":[{"text":".name {\n            font-size: 16px;\n            margin-right: 5px;\n            color: #000;\n        }\n        .amc-cell-l-box{\n            width:80px;\n            padding-right: 5px;\n        }\n        .detail-cell {\n            align-items: center;\n            background-color: #fff;\n            padding: 5px 15px;\n        }\n        .align-start {\n            align-items: flex-start;\n        }\n        \n        .l-label-ellipsis {\n            -webkit-line-clamp:3;\n            -webkit-box-orient:vertical;\n            display:-webkit-box;\n        }\n        .amc-cell-l-box{\n            width:80px;\n            padding-right: 5px;\n        }","tag":"text"}]}]},{"id":"body","onload":"init()","tag":"body","children":[{"id":"mainBody","tag":"div","children":[{},{"id":"cardNameArea","tag":"div","children":[{"tag":"div","children":[{"id":"cardName","tag":"label","css":"amc-font-m amc-text-slight-color "}],"css":"amc-pd-lr amc-pd-b-s"}],"css":"amc-v-box amc-hidden"},{},{"id":"nameCvv2ValidateSpace","tag":"div","children":[{"tag":"div","css":"amc-1px-line"},{},{"id":"fullNameArea","tag":"div","children":[{"tag":"div","children":[{"tag":"div","children":[{"tag":"label","children":[{"text":"{{name}}","tag":"text"}],"css":"name  amc-flex-1 l-label-ellipsis"}],"css":"amc-cell-l-box"},{"tag":"div","children":[{"id":"fullName","placeholder":"{{input_name_on_card}}","tag":"input","value":"","css":"amc-input","oninput":"onInput('fullName')"}],"css":"amc-cell-m-box amc-input-box-height"}],"css":"detail-cell  amc-pd-lr"}],"css":"amc-v-box amc-hidden"},{},{"id":"validateArea","tag":"div","children":[{"tag":"div","css":"amc-1px-line amc-margin-l"},{"tag":"div","children":[{"tag":"div","children":[{"tag":"label","children":[{"text":"{{validity_text}}","tag":"text"}],"css":"amc-cell-l-text  amc-flex-1 l-label-ellipsis"}],"css":"amc-cell-l-box"},{"tag":"div","children":[{"id":"validate","placeholder":"{{month_year}}","tag":"input","value":"","type":"month","css":"amc-input","oninput":"onInput('validate','validateInfoPng')"}],"css":"amc-cell-m-box amc-input-box-height"},{"tag":"div","children":[{"id":"validateInfoPng","tag":"img","onclick":"onClickValidate()"}]}],"css":"detail-cell  amc-pd-lr"}],"css":"amc-v-box amc-hidden"},{},{"id":"cvv2Area","tag":"div","children":[{"tag":"div","css":"amc-1px-line amc-margin-l"},{"tag":"div","children":[{"tag":"div","children":[{"tag":"label","children":[{"text":"{{cvv_text}}","tag":"text"}],"css":"amc-cell-l-text amc-flex-1 l-label-ellipsis"}],"css":"amc-cell-l-box"},{"tag":"div","children":[{"id":"cvv2","maxlength":"3","placeholder":"{{last_three_num}}","tag":"input","value":"","type":"number","css":"amc-input","oninput":"onInput('cvv2','cvv2InfoImg')"}],"css":"amc-cell-m-box amc-input-box-height"},{"tag":"div","children":[{"id":"cvv2InfoImg","tag":"img","onclick":"onclickCvv()"}]}],"css":"detail-cell  amc-pd-lr"}],"css":"amc-v-box amc-hidden"},{"tag":"div","css":"amc-1px-line"},{},{"tag":"div","css":"amc-abs-space-v-l"}],"css":"amc-v-box"},{},{"id":"emailArea","tag":"div","children":[{"tag":"div","css":"amc-1px-line"},{"tag":"div","children":[{"tag":"div","children":[{"tag":"label","children":[{"text":"{{email}}","tag":"text"}],"css":"amc-cell-l-text amc-flex-1 l-label-ellipsis"}],"css":"amc-cell-l-box"},{"tag":"div","children":[{"id":"email","placeholder":"{{email_address}}","tag":"input","value":"","css":"amc-input","oninput":"onInput('email')"}],"css":"amc-cell-m-box amc-input-box-height"}],"css":"detail-cell  amc-pd-lr"},{"tag":"div","css":"amc-1px-line"},{},{"tag":"div","css":"amc-abs-space-v-l"}],"css":"amc-v-box amc-hidden"},{},{"id":"receiveAddressArea","tag":"div","children":[{"tag":"div","css":"amc-1px-line"},{"tag":"div","children":[{"tag":"div","children":[{"tag":"label","children":[{"text":"{{bill_address}}","tag":"text"}],"css":"amc-cell-l-text amc-flex-1 l-label-ellipsis"}],"css":"amc-cell-l-box amc-align-self-start"},{"tag":"div","children":[{"id":"receiveAddress","tag":"label","css":"amc-cell-l-text amc-flex-1"}],"css":"amc-cell-m-box amc-pd-r"},{"id":"billAddrRightArrow","tag":"img"}],"onclick":"onClickBill()","css":"amc-large-cell amc-pd-lr amc-pd-t-s amc-pd-b-s amc-height-auto"},{"tag":"div","css":"amc-1px-line"},{},{"tag":"div","css":"amc-abs-space-v-xxl "}],"css":"amc-v-box amc-hidden"},{},{"tag":"div","children":[{"id":"loading","tag":"img","src":"indicatior","css":"amc-loading-img amc-text-white-clolor amc-hidden"},{"id":"submit","tag":"button","children":[{"text":"{{next}}","tag":"text"}],"onclick":"onSubmit()","css":"amc-btn-primary","disabled":"true"}],"css":"amc-margin-lr amc-margin-b amc-align-center amc-justify-center amc-btn-primary"}],"css":"amc-main amc-scroll-android"},{"id":"dlg","tag":"dialog","children":[{"id":"dlg_title","tag":"label","css":"amc-dlg-title"},{"tag":"div","children":[{"id":"dlg_img","tag":"img"}],"css":"amc-justify-center"},{"id":"dlg_text","tag":"label","css":"amc-dlg-txt"},{"tag":"div","css":"amc-adapt-line amc-dlg-width"},{"id":"btn_main","tag":"button","children":[{"text":"{{i_know_it}}","tag":"text"}],"onclick":"getTag('dlg').close()","css":"amc-theme-color amc-dlg-btn"}],"css":"amc-dlg-box amc-v-box"}],"onkeydown":"onKeyDown();","css":"amc-body"}]},"format":"JSON","tplVersion":"5.0.8"}