{"time":"0022","tplId":"QUICKPAY@cashier-pre-confirm-flex","publishVersion":"150924","tag":"QUICKPAY","name":"cashier-pre-confirm-flex","data":{"tag":"html","children":[{"tag":"head","children":[{"tag":"meta","src":"AlipaySDK.bundle/amc.i18n","type":"i18n"},{"tag":"script","src":"AlipaySDK.bundle/amc.js"},{"tag":"link","rel":"stylesheet","href":"AlipaySDK.bundle/amc.css"},{"tag":"script","children":[{"text":"var rpc=amc.rpcData;var getTag=amc.fn.getById;var hide=amc.fn.hide;var show=amc.fn.show;var create=amc.fn.create;var confirmFQG=(rpc.is_fqg===\"Y\")?\"{{confirm_fqg}}\":\"\";var showAggr=(rpc.show_aggr===\"Y\");var showLogo=rpc.showLogo||false;var fingerPay=rpc.fingerPay||false;if(rpc.AndroidFingerStatus===\"1\"){fingerPay=false}var wearablePay=rpc.wearablePay;var wearablePayText=\"{{auth_bic}}\";if(!wearablePay){wearablePay=rpc.braceletPay;wearablePayText=\"{{auth_bracelet}}\"}var payAction=rpc.payAct||\"/cashier/pay\";var btnAction=rpc.btnAction;var isIOS83=amc.isIOS&&(amc.fn.versionCompare&&amc.fn.versionCompare(amc.osVersion,\"8.1.3\")>=0);if(rpc.fingerPay&&isIOS83){var fpCancelAction=rpc.pageSwitch&&rpc.pageSwitch.fpCancelAction}var needArrow=(rpc.channels||rpc.switchAcc);var isHuaWeiFinger=(amc.isAndroid&&fingerPay&&rpc.fpProtocolType===\"2\");var arrowPaddingRight=amc.isAndroid?19:23;var serverDefinedProtocol=rpc.protocolName&&rpc.protocolUrl;var buttonEnabled=true;function init(){try{initUI();if(amc.fn.logPageInit){amc.fn.logPageInit(true)}}catch(a){if(amc.fn.logPageInit){amc.fn.logPageInit()}}}function initNav(){var a;if(showLogo){a=amc.path+\"alipay_msp_i_logo\"}var b=amc.fn.iNav(amc.res.close,rpc.navTitle||\"{{pay_detail}}\",null,amc.res.help,onClose,onHelp,a);b.id=\"iNav\";getTag(\"body\").insertBefore(b,getTag(\"iLine\"));getTag(\"iNavImgR\")&&(getTag(\"iNavImgR\").alt=\"{{help}}\");getTag(\"iNavImgM\")&&(getTag(\"iNavImgM\").alt=\"{{alipay}}\")}function initUI(){initNav();if(rpc.cost){var g=getTag(\"totalCost\");var f=rpc.cost||\"\";getTag(\"totalCostImg\").src=amc.path+\"alipay_msp_rmb\";if(amc.isIOS){getTag(\"totalCostImg\").style.marginTop=\"-2px\"}g.innerText=f;g.style.maxWidth=window.innerWidth-(30+30);amc.fn.show(\"totalCostBox\")}getTag(\"confirmLabel\").innerText=confirmFQG||rpc.btnName||\"{{pay_right_now}}\";var e=amc.specs.iBodyHeight-amc.specs.iNavHeight-72;if(rpc.payTool){createPayment(rpc.payTool,rpc.redPoint,rpc.channels);e-=45}if(rpc.propagate&&rpc.propagate.title){createPropagate(rpc.propagate);e-=45}if(showAggr){if(serverDefinedProtocol){getTag(\"protocolName\").innerText=rpc.protocolName}show(\"protocol\");e-=35}if(isHuaWeiFinger){hide(\"btnContainer\");getTag(\"androidFingerPng\").src=amc.path+\"alipay_msp_mini_finger.png\";show(\"androidFinger\");fingerPayHuawei();document.onreload=function(h){fingerPayHuawei()}}getTag(\"scrollableBox\").style.maxHeight=e;for(var b=0;rpc.detail&&b<rpc.detail.length;b++){var d=rpc.detail[b];createDetail(d.info,d.price,d.isDiscount)}if(rpc.productDetailKey){createDetail(rpc.productDetailKey,rpc.productDetail)}if(rpc.product){createDetail(rpc.order||\"{{order_info}}\",rpc.product)}if(rpc.gonggao){var c=create(\"div\");c.className=\"amc-marquee amc-pd-lr\";var a=amc.fn.getMarquee(rpc.gonggao);c.appendChild(a);a.style.width=window.innerWidth-(amc.isPlus?40:30);getTag(\"body\").insertBefore(c,getTag(\"iNav\"));getTag(\"body\").style.height=(amc.specs.iBodyHeight+amc.specs.marqueeHeight)+\"px\"}getTag(\"payingText\").style.maxWidth=window.innerWidth-70;if(amc.isAndroid){getTag(\"loading\").src=amc.path+\"alipay_msp_indicator_white_loading\"}}function calculateFontWidth(d){if(!d){return 0}var b=0;var c=/^[A-Za-z0-9\\.\\(\\)]*$/;for(var a=0;a<d.length;a++){if(c.test(d[a])){b+=0.45}else{b++}}return Math.round(b)}function substrWithFontWidth(h,e,g){if(!h){return h}var j=\"\";var f=0;var a=h.length;for(var c=0;c<a;c++){var b=g?h[a-c-1]:h[c];var d=/^[A-Za-z0-9\\(\\)]*$/;if(d.test(b)){f+=0.45}else{f++}j+=b;if(f>e-1){break}}return j}function shouldShowWithSmallerFont(e,b,f){var d=window.innerWidth-30-72-(!!b+0)*17-(!!f+0)*17-5;var c=calculateFontWidth(e);var a=Math.floor(d/(16+1));return a<c}function truncatePayment(g,c,h){var f=window.innerWidth-30-72-(!!c+0)*17-(!!h+0)*17-5;var e=calculateFontWidth(g);var d=Math.floor(f/(14+1));if(d<e){var b=calculateFontWidth(g.substr(-9,g.length));var a=(substrWithFontWidth(g,d-b)||\"\").length;g=amc.fn.stringTruncate(g,a,9)}return g}function createPayment(d,b,m){if(!d){return}if(!m){b=false}var c=getTag(\"anchoredBox\");amc.fn.show(\"anchoredBox\");var l=create(\"div\",\"item-box amc-align-center\",c);var i=create(\"div\",\"amc-1px-line margin-l\",c);var g=create(\"label\",\"info-text info-key\",l);g.style.maxWidth=\"72px\";g.innerText=\"{{pay_tool}}\";var a=\"info-text info-value amc-flex-1 amc-ellipsis\";if(shouldShowWithSmallerFont(d,b,m)){a=\"info-text-s info-value amc-flex-1 amc-ellipsis\";d=truncatePayment(d,b,m)}var f=create(\"label\",a,l);f.innerText=d||\"\";if(b){var k=create(\"div\",\"red-point\",l);k.style.marginLeft=\"9px\"}if(m){var h=create(\"div\",\"img-box\",l);var e=create(\"img\",\"arrow-img\",h);e.src=amc.res.arrowRight;var j=create(\"img\",\"amc-hidden\",h);j.src=\"indicatior\";l.onclick=function(){hide(e);show(j);var n={action:{name:\"/cashier/switchChannel\",loadtxt:\"\"}};n.param={};n.param[\"fromCashier\"]=true;document.asyncSubmit(n,function(o){amc.fn.shouldShowBtnIndicator(o,e,j)})}}return l}function createDetail(d,f,b){if(!d&&!f){return}var e=create(\"div\",\"info-box amc-align-cetner\",getTag(\"scrollableBox\"));var c=null;if(d){c=create(\"label\",\"info-text info-key amc-ellipsis\"+(b?\" highlight\":\"\"),e);c.innerText=d}var g=null;if(f){g=create(\"label\",\"info-text info-value amc-flex-1 amc-ellipsis\"+(b?\" highlight\":\"\"),e);g.innerText=f}if(c&&g){var a=calculateFontWidth(f);if(a*(16+1)<((window.innerWidth-40)/2)){c.className+=\" amc-flex-1\";g.style.flex=\"0\"}else{c.className+=\" info-k-w-limit\"}}else{if(c){c.className+=\" amc-flex-1\"}else{if(g){g.style.marginLeft=\"40%\"}}}}function createPropagate(e){if(!e||!e.title){return}var a=getTag(\"anchoredBox\");amc.fn.show(\"anchoredBox\");var g=e.actTitle;var f=create(\"div\",\"item-box amc-align-cetner\",a);var c=create(\"div\",\"amc-1px-line margin-l\",a);var h=e.action?f:\"\";var d=null;if(g){d=create(\"label\",\"info-text amc-flex-1 amc-ellipsis\",f);var b=create(\"div\",\"item-btn\",f);var i=create(\"label\",\"item-btn-text amc-ellipsis\",b);i.innerText=g;b.onmousedown=function(){b.style.backgroundColor=\"#108ee9\";i.style.color=\"#fff\"};b.onmouseup=function(){b.style.backgroundColor=\"#fff\";i.style.color=\"#108ee9\"};h=b}else{d=create(\"label\",\"double-line-for-propagate info-text-s amc-flex-1 amc-ellipsis-2-line\",f);f.className=\"item-box-for-propagate amc-press-box\"}d.innerText=e.title;if(h){h.onclick=function(){var j={action:{name:e.action,loadtxt:\"\"}};j.param=e.param;if(j.param){j.param[\"first_enter_cashier\"]=j.param[\"first_enter_cashier\"]||false}document.submit(j);if(e.dlg){setTimeout(function(){showDlg(e.dlg)},1000)}}}}function fingerPayHuawei(){var a={action:{name:rpc.authAction}};document.asyncSubmit(a,function(c){var b=window.innerWidth-80;if(c.status===\"0001\"){getTag(\"fingerTextLeft\").innerText=\"{{pay_success}}\";getTag(\"fingerTextLeft\").style.maxWidth=b;hide(\"fingerTextRight\")}else{if(c.status===\"0002\"){getTag(\"fingerTextLeft\").innerText=\"{{auth_fingering}}\";getTag(\"fingerTextLeft\").style.maxWidth=b;hide(\"fingerTextRight\")}else{if(c.status===\"0003\"){getTag(\"fingerTextLeft\").innerText=\"{{paying}}\";getTag(\"fingerTextLeft\").style.maxWidth=b;hide(\"fingerTextRight\")}else{if(c.status===\"0004\"){gotoPwdArea()}else{if(c.status===\"0005\"){getTag(\"fingerTextLeft\").innerText=\"{{retry_finger}}\";getTag(\"fingerTextLeft\").style.maxWidth=b;hide(\"fingerTextRight\")}}}}}})}function showProtocol(){if(serverDefinedProtocol){document.submit({action:{name:\"loc:openweb('\"+rpc.protocolUrl+\"', '\"+(rpc.protocolTitle||\"{{serve_protocol}}\")+\"')\"}});return}var a=rpc.protocols||[{text:\"{{pcredit_protocol}}\",url:\"https://ds.alipay.com/credit/infoContract.htm\"},{text:\"{{pcredit_user_protocol}}\",url:\"https://ds.alipay.com/credit/hbContract.htm\"}];amc.fn.showProtocolList(a)}function bypassData(){var a=rpc.bypass||{};a.pwd=amc.fn.isObject(a.pwd)?a.pwd:{};a.pwd[\"spasswordPay\"]=rpc.spasswordPay;if(!(isHuaWeiFinger||wearablePay)){a.pwd[\"payOrder\"]=true}a.pwd[\"nextAction\"]=payAction;a.pwd[\"pwdTip\"]=rpc.pwdTip;a.pwd[\"logon_id\"]=rpc.logon_id;return a}function gotoPwdArea(){var a=bypassData()||{};var b={};b.action={name:\"loc:bnvb\"};b.param={};b.param[\"data\"]=a.pwd;b.param[\"tplid\"]=\"QUICKPAY@open-pwd-check-flex\";b.param[\"tpl\"]=rpc.tpl;document.submit(b)}function onPaySuccess(){var b=getTag(\"payingText\");getTag(\"gifImg\").src=amc.res.success;b.style.opacity=0.2;var a=setTimeout(function(){b.innerText=\"{{pay_ok}}   \";b.style.opacity=1},500)}function loadingWithText(a){hide(\"gifImg\");getTag(\"payingText\").innerText=a||\"\";showPayingBtn();show(\"gifImg\")}function stopLoading(){hide(\"pay\");getTag(\"gifImg\").src=\"\";show(\"confirm\");show(\"btnConfirm\");hide(\"loading\")}function showPayingBtn(){hide(\"confirm\");show(\"pay\");getTag(\"gifImg\").src=amc.res.loading}function loading(){hide(\"btnConfirm\");show(\"loading\")}function alert(){var b=b||\"{{confirm_exit}}\";var a={title:\"\",message:b,okButton:\"{{confirm_btn}}\",cancelButton:\"{{input_pwd_s}}\"};document.confirm(a,function(c){if(c.ok){amc.fn.exit();amc.fn.logCount(\"fp\",\"confirmCancel\")}else{gotoPwdArea();amc.fn.logCount(\"fp\",\"confirmSwitch\")}})}function realPay(){if(rpc.npwdPay){showPayingBtn();var a={action:{name:payAction,loadtxt:\"\"}};a.action[\"neec\"]=\"6004\";document.asyncSubmit(a,function(c){var b=c.status;if(b===\"0001\"){onPaySuccess()}else{if(b===\"0002\"||b===\"0006\"||b===\"0000\"){stopLoading()}}})}else{if(fingerPay||wearablePay){var a={action:{name:rpc.authAction,loadtxt:\"\"}};if(amc.fn.sdkGreaterThan&&amc.fn.sdkGreaterThan(\"10.6.1\")){a.param={nativeValidate:true}}loadingWithText(fingerPay?\"{{finger_process}}\":wearablePayText);document.asyncSubmit(a,function(c){var b=c.status&&c.status.substr(-2);if(b===\"01\"){onPaySuccess()}else{if(b===\"03\"){loadingWithText(\"{{paying}}\")}else{if(b===\"09\"){stopLoading();if(fpCancelAction===\"1\"){gotoPwdArea()}else{if(fpCancelAction===\"2\"){alert()}else{amc.fn.exit()}}}else{if(b===\"00\"){stopLoading();getTag(\"payingText\").innerText=\"{{paying}}\"}else{if(b===\"04\"||b===\"05\"){stopLoading();getTag(\"payingText\").innerText=\"{{paying}}\";if(c.tip){rpc.pwdTip=c.tip}gotoPwdArea()}}}}}})}else{gotoPwdArea()}}}function btnActionExecute(){var a={};a.action={name:btnAction,loadtxt:\"\"};document.asyncSubmit(a,function(b){amc.fn.shouldShowBtnIndicator(b,\"btnConfirm\",\"loading\")});loading()}function onPay(){var a=btnAction?btnActionExecute:realPay;if(rpc.chargeMsg){var b={title:\"\",message:rpc.chargeMsg,okButton:\"{{confirm_btn}}\",cancelButton:\"{{cancel}}\"};document.confirm(b,function(c){if(c.ok){a()}})}else{a()}}function gotoPwdAreaWithLog(){gotoPwdArea();amc.fn.logCount(\"fp\",\"FpPreToPwd\")}function onClose(){amc.fn.exit()}function onHelp(){document.submit({action:{name:\"loc:openweb('https://csmobile.alipay.com/router.htm?scene=app_paymentpage', '{{help}}')\"}})}function onKeyDown(){if(event.which==4){onClose()}}function showDlg(a){if(!a||!a.btnRight||!a.dlgTxt||!a.btnLeft||!a.btnRightAction){return}getTag(\"dlgTxt\").innerText=a.dlgTxt;getTag(\"btnLeft\").innerText=a.btnLeft;getTag(\"btnRight\").innerText=a.btnRight;getTag(\"btnRight\").onclick=function(){var b={action:{name:a.btnRightAction}};document.submit(b);getTag(\"dlg\").close()};getTag(\"dlg\").showModal()};","tag":"text"}]},{"tag":"style","children":[{"text":".arrow-img {\n    margin-left: 4px;\n    width: 8px;\n    max-width: 8px;\n}\n\n.img-box {\n    width: 20px;\n    margin: 0 -8px 0 5px;\n    align-items: center;\n}\n\n.text-right {\n    text-align: right;\n}\n.change-discount {\n    color: #108ee9;\n    text-align: right;\n    flex: 0;\n}\n.btn-text{font-weight:bold;color:#108ee9; margin: 15px 0;}\n.btn-vertical-line{width:1px; align-self:stretch; margin: 7px 0;background-color:#e5e5e5;}\n.need-to-pay {\n    width: 100px;\n}\n.agree-label {\n    max-width: 100px;\n}\n.finger-text-l {\n    max-width: 160px;\n    -webkit-line-clamp:2;\n    -webkit-box-orient:vertical;\n    display:-webkit-box;\n}\n.dlg-title{\n    -webkit-line-clamp:4;\n    -webkit-box-orient:vertical;\n    display:-webkit-box;\n}\n\n.highlight {\n    color:#ff6600;\n}\n\n.info-text {\n    font-size: 16px;\n}\n\n.info-text-s {\n    font-size: 14px;\n}\n\n.info-key {\n    color: #777;\n}\n\n.info-value {\n    text-align: right;\n    margin-left: 5px;\n}\n\n.info-box {\n    padding-bottom: 15px;\n}\n\n.info-k-w-limit {\n    max-width: 40%;\n}\n\n.pd-lr {\n    padding: 0 15px;\n}\n\n.item-box {\n    height: 44px;\n    max-height: 44px;\n    min-height: 44px;\n    padding: 12px 15px;\n}\n\n.item-box-for-propagate {\n    height: 44px;\n    max-height: 44px;\n    min-height: 44px;\n    padding: 5px 15px;\n}\n\n.double-line-for-propagate {\n    height: 34px;\n}\n\n.item-btn {\n    margin-left: 5px;\n    border: 1px solid #108ee9;\n    border-radius: 2px;\n    padding: 0 4px;\n    align-items: center;\n}\n\n.item-btn-text {\n    font-size: 14px;\n    color:#108ee9;\n    text-align: center;\n    max-width: 90px;\n}\n\n.top-pd {\n    height: 17px;\n}\n\n.red-point {\n    width: 8px;\n    height: 8px;\n    background-color: #ff0000;\n    border-radius: 5px;\n}\n\n.margin-lr {\n    margin: 0 15px;\n}\n\n.margin-l {\n    margin-left: 15px;\n}\n\n.protocol-box {\n    height: 50px;\n    max-height: 50px;\n    min-height: 50px;\n    padding: 0 15px 15px 15px;\n}\n\n.protocol-link  {\n    margin-left: 5px;\n}\n\n.btn-font {\n    font-size: 18px;\n}\n\n.btn-primary {\n    background-color:#108ee9;\n    border: 0;\n    border-radius: 5px;\n    color:#fff;\n    font-size:18px;\n    height: 42px;\n    max-height: 42px;\n    min-height: 42px;\n    flex: 1.0;\n}\n.btn-primary:active {\n    background-color:#1284D6;\n    color:#fff;\n}\n.btn-primary:disabled {\n    background-color:#ebebf0;\n    color:#d2d2d2;\n}\n\n.finger-box {\n    background-color: #f5f5f9;\n    padding: 21px 15px;\n    align-items: center;\n    justify-content: center;\n    display: none;\n}\n\n.finger-img {\n    height: 30px;\n    width: 30px;\n    max-height: 30px;\n    max-width: 30px;\n}\n\n.finger-info {\n    margin-left: 6.5px;\n    max-width: 40%;\n}\n\n.input-info {\n    margin-left: 6.5px;\n    max-width: 30%;\n}\n\n.bottom-box {\n    justify-content: flex-end;\n    flex: 1;\n}\n\n.pay-btn-box {\n    flex-direction: column;\n    overflow: hidden;\n    margin: 15px;\n    height: 42px;\n    min-height: 42px;\n    border-radius: 5px;\n    background-color: #108ee9;\n    justify-content: flex-end;\n}\n\n.pay-text {\n    font-size: 18px;\n    color: #fff;\n}\n\n.btn-img {\n    width:24px;\n    height:24px;\n    margin-right:8px;\n}\n.bottom-section {\n    height: 72px;\n    max-height: 72px;\n    min-height: 72px;\n}\n\n.total-cost {\n    font-size: 36px;\n    max-height: 43px;\n}\n\n.total-cost-box {\n    height: 43px;\n    margin-bottom: 22px;\n    justify-content: center;\n    align-items: center;\n}\n\n.total-cost-img {\n    height: 50px;\n}\n\n.shade {\n    background-color: #fff;\n    opacity: 0.90;\n    margin-top: -18px;\n    height: 18px;\n}","tag":"text"}]}]},{"id":"body","onload":"init()","tag":"body","children":[{"id":"iLine","tag":"div","css":"amc-1px-title-line"},{},{"id":"cashier","tag":"div","children":[{},{"id":"scrollableBox","tag":"div","children":[{},{"tag":"div","css":"top-pd"},{"id":"totalCostBox","tag":"div","children":[{"id":"totalCostImg","tag":"img","css":"total-cost-img"},{"id":"totalCost","tag":"label","css":"total-cost amc-text-center amc-ellipsis"}],"css":"total-cost-box amc-hidden"}],"css":"amc-scroll pd-lr"},{},{"tag":"div","css":"shade"},{},{"id":"anchoredBox","tag":"div","children":[{"tag":"div","css":"amc-1px-line margin-l"}],"css":"amc-v-box amc-hidden"},{},{"id":"protocol","tag":"div","children":[{"id":"agree","tag":"label","children":[{"text":"{{pay_agree}}","tag":"text"}],"css":"info-text info-key agree-label amc-ellipsis-2-line"},{"id":"protocolName","tag":"label","children":[{"text":"{{serve_protocol}}","tag":"text"}],"onclick":"showProtocol()","css":"protocol-link amc-flex-1 info-text amc-theme-color amc-ellipsis"}],"css":"amc-hidden protocol-box amc-align-center"},{"tag":"div","children":[{},{"id":"btnContainer","tag":"div","children":[{"id":"confirm","tag":"div","children":[{"id":"loading","tag":"img","src":"indicatior","css":"amc-loading-img amc-text-white-clolor amc-hidden"},{"id":"btnConfirm","tag":"div","children":[{"id":"confirmLabel","tag":"label","children":[{"text":"{{pay_right_now}}","tag":"text"}],"css":"pay-text amc-flex-1 amc-text-center amc-ellipsis"}],"onclick":"onPay();","css":"btn-font btn-primary amc-align-center amc-justify-center"}],"css":"btn-font btn-primary amc-align-center amc-justify-center"},{},{"id":"pay","tag":"div","children":[{"id":"gifImg","tag":"embed","type":"MQPPayGifView","css":"btn-img"},{"id":"payingText","tag":"label","children":[{"text":"{{paying}}","tag":"text"}],"css":"pay-text amc-btn-ellpsis"}],"css":"btn-primary btn-font amc-align-center amc-justify-center amc-hidden"}],"css":"pay-btn-box"},{},{"id":"androidFinger","tag":"div","children":[{"id":"androidFingerPng","tag":"img","css":"finger-img"},{"id":"fingerTextLeft","tag":"label","children":[{"text":"{{auth_finger_or}}","tag":"text"}],"css":"info-text info-key finger-info amc-ellipsis"},{"id":"fingerTextRight","tag":"label","children":[{"text":"{{input_pwd_s}}","tag":"text"}],"onclick":"gotoPwdAreaWithLog()","css":"info-text input-info amc-ellipsis amc-theme-color"}],"css":"finger-box bottom-section"}],"css":"bottom-box amc-v-box"}],"css":"amc-column-flex-1"},{"id":"dlg","tag":"dialog","children":[{"id":"dlgTxt","tag":"label","css":"amc-font-m amc-text-center amc-margin dlg-title"},{"tag":"div","children":[{"tag":"div","css":"amc-adapt-line"},{"tag":"div","children":[{"id":"btnLeft","tag":"label","onclick":"getTag('dlg').close();","css":"btn-text amc-font-xxl amc-flex-1 amc-text-center amc-ellipsis-2-line"},{"tag":"div","css":"btn-vertical-line"},{"id":"btnRight","tag":"label","css":"btn-text amc-font-xxl amc-flex-1 amc-text-center amc-ellipsis-2-line"}],"css":"amc-align-center amc-justify-center"}],"css":"amc-v-box amc-justify-center amc-dlg-width"}],"css":"amc-dlg-box amc-v-box"}],"onkeydown":"onKeyDown();","css":"amc-i-body"}]},"format":"JSON","tplVersion":"5.1.7"}